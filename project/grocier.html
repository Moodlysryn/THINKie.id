<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Grocier</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/grocier.css" />
  </head>
  <body>
    <div class="editor-panel" role="application">
      <div class="topbar">
        <i class="fa-solid fa-image" title="Insert image"></i>
        <i class="fa-solid fa-bell" title="Notifications"></i>
      </div>
    </div>
    <div class="container">
      <div class="card-custom">
        <h5 id="listTitle" class="tittle" contenteditable="true">Groceries</h5>
        <p class="small">3 of 6 tasks</p>
        <!--CHECKLIST-->
        <div class="form-check">
          <input class="form-check-input" type="checkbox " id="item1" checked />
          <label class="form-check-label" for="item1">Cooking oil</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox " id="item2" checked />
          <label class="form-check-label" for="item2">Croissants sugar</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox " id="item3" checked />
          <label class="form-check-label" for="item3">Instant noodles</label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox " id="item4" checked />
          <label class="form-check-label" for="item4">Coffee and tea </label>
        </div>
        <div class="form-check">
          <input class="form-check-input" type="checkbox " id="item5" checked />
          <label class="form-check-label" for="item5">Garlic, onions</label>
        </div>
      </div>
    </div>
    <!--TOOLBAR-->
    <div class="toolbar" role="toolbar" aria-label="Formatting toolbar">
      <button data-cmd="formatBlock" data-value="h1" title="H1">H1</button>
      <button data-cmd="formatBlock" data-value="h2" title="H2">H2</button>
      <button data-cmd="fontSize" data-value="3" title="Aa">Aa</button>
      <button data-cmd="bold" title="Bold"><b>B</b></button>
      <button data-cmd="italic" title="Italic"><i>I</i></button>
      <button data-cmd="underline" title="Underline"><u>U</u></button>
      <button data-cmd="strikeThrough" title="Strike">
        <i class="fa-solid fa-strikethrough"></i>
      </button>
    </div>
    <script>
      const editor = document.getElementById("editor");
      const toolbar = document.querySelector(".toolbar");
      const linkBtn = document.getElementById("linkBtn");

      // Focus editor when user clicks inside the panel (UX)
      document.querySelector(".editor-panel").addEventListener("click", (e) => {
        if (!e.target.closest(".toolbar") && !e.target.closest(".link-btn")) {
          editor.focus();
        }
      });

      // Exec command helper
      function exec(cmd, value = null) {
        editor.focus();
        // special handling for fontSize: convert numeric to execCommand param (1-7)
        if (cmd === "fontSize") {
          document.execCommand("fontSize", false, value);
          return;
        }
        document.execCommand(cmd, false, value);
      }

      // Toolbar button clicks
      toolbar.addEventListener("click", (e) => {
        const btn = e.target.closest("button");
        if (!btn) return;
        const cmd = btn.dataset.cmd;
        const value = btn.dataset.value || null;

        if (cmd === "formatBlock") {
          // formatBlock expects block name like <h1>, <h2>
          exec("formatBlock", value);
        } else if (cmd) {
          exec(cmd, value);
        }

        updateActiveStates();
      });

      // Link button: prompt URL and create link at selection
      linkBtn.addEventListener("click", () => {
        editor.focus();
        const url = prompt(
          "Enter URL (include http:// or https://):",
          "https://"
        );
        if (url) {
          // createLink will wrap selected text; if no selection, insert link text as url
          document.execCommand("createLink", false, url);
        }
      });

      // Keep toolbar button active state (basic)
      function updateActiveStates() {
        const buttons = toolbar.querySelectorAll("button[data-cmd]");
        buttons.forEach((btn) => {
          const cmd = btn.dataset.cmd;
          let active = false;
          try {
            if (cmd === "formatBlock") {
              // check current block (h1/h2)
              const selection = window.getSelection();
              if (selection.rangeCount) {
                const node = selection.anchorNode;
                const el = node.nodeType === 3 ? node.parentElement : node;
                const tag = el.closest && el.closest("h1, h2");
                if (tag) {
                  active = tag.tagName.toLowerCase() === btn.dataset.value;
                } else {
                  active = false;
                }
              }
            } else {
              active = document.queryCommandState(cmd);
            }
          } catch (e) {
            active = false;
          }
          btn.classList.toggle("active", active);
        });
      }

      // update on selection change / keyup / mouseup
      editor.addEventListener("keyup", updateActiveStates);
      editor.addEventListener("mouseup", updateActiveStates);
      editor.addEventListener("keydown", function (e) {
        // allow Ctrl/Cmd+B etc to work â€” update states slightly after
        setTimeout(updateActiveStates, 10);
      });

      // Tambah item baru
      function addItem() {
        const container = document.getElementById("checklistContainer");
        const div = document.createElement("div");
        div.className = "form-check mb-2 d-flex align-items-center";
        div.innerHTML = `
        <input class="form-check-input me-2" type="checkbox">
        <input type="text" class="checklist-item" placeholder="New item..">
      `;
        container.appendChild(div);
      }

      const titleEl = document.getElementById("listTitle");
      const STORAGE_KEY = "listTitle";

      // Load judul dari localStorage saat halaman dibuka
      window.addEventListener("DOMContentLoaded", () => {
        const savedTitle = localStorage.getItem(STORAGE_KEY);
        if (savedTitle) {
          titleEl.innerText = savedTitle;
        }
      });

      // Simpan otomatis saat teks berubah
      function saveTitle() {
        localStorage.setItem(STORAGE_KEY, titleEl.innerText);
      }

      titleEl.addEventListener("input", saveTitle); // realtime
      titleEl.addEventListener("blur", saveTitle); // saat selesai edit
    </script>
  </body>
</html>
